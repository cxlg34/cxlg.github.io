<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="从心来过" />





  <link rel="alternate" href="/atom.xml" title="记忆博客" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="都付笑谈中">
<meta property="og:type" content="website">
<meta property="og:title" content="记忆博客">
<meta property="og:url" content="http://www.cxlg34.com/index.html">
<meta property="og:site_name" content="记忆博客">
<meta property="og:description" content="都付笑谈中">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="记忆博客">
<meta name="twitter:description" content="都付笑谈中">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.cxlg34.com/"/>





  <title> 记忆博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">记忆博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">记录点滴</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.cxlg34.com/2017/05/17/KVM常用命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="从心来过">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记忆博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/17/KVM常用命令/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-17T13:33:58+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <hr>
<p>title: KVM常用命令<br>date: 2017-05-17 14:13:13<br>update: 2017-05-17 14:13:13<br>tags:<br>categories: </p>
<h2 id="KVM"><a href="#KVM" class="headerlink" title="   - KVM"></a>   - KVM</h2><h2 id="KVM常用命令"><a href="#KVM常用命令" class="headerlink" title="KVM常用命令"></a>KVM常用命令</h2><h3 id="编辑、备份XML文件"><a href="#编辑、备份XML文件" class="headerlink" title="编辑、备份XML文件"></a>编辑、备份XML文件</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">virsh edit ostest1</div><div class="line">virsh dumpxml ostest1 &gt; <span class="regexp">/kvmdump/</span></div></pre></td></tr></table></figure>
<h2 id="创建存储池"><a href="#创建存储池" class="headerlink" title="创建存储池"></a>创建存储池</h2><figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">mkdir</span> /data/<span class="built_in">vol</span> </div><div class="line">virsh pool-define-as vmdisk --<span class="built_in">type</span> <span class="built_in">dir</span> --target /data/<span class="built_in">vol</span> </div><div class="line">virsh pool-build vmdisk</div></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/05/17/KVM常用命令/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.cxlg34.com/2017/05/17/高性能Mysql笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="从心来过">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记忆博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/17/高性能Mysql笔记/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-17T13:33:58+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>title: 高性能Mysql笔记<br>date: 2017-05-17 14:10:00<br>update: 2017-05-17 14:10:00<br>tags:<br>categories:</p>
<h2 id="Mysql笔记"><a href="#Mysql笔记" class="headerlink" title="   - Mysql笔记"></a>   - Mysql笔记</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">show global status </div><div class="line">threads_running</div><div class="line">threads_connected</div><div class="line">questions</div><div class="line">queries </div><div class="line"></div><div class="line">mysqladmin ext -i1 | awk '</div><div class="line">/Queries/&#123;q=$4-qp;qp=$4&#125;</div><div class="line">/Threads_connected/&#123;tc=$4&#125;</div><div class="line">/Threads_running/&#123;printf "%5d %5d %5d\n",q,tc,$4&#125;' </div><div class="line">``` </div><div class="line"></div><div class="line"><span class="comment">&lt;!--more--&gt;</span></div></pre></td></tr></table></figure>
<p>mysqladmin -uroot -p -h127.0.0.1 -P3306 -r -i 1 ext |\<br>awk -F”|” ‘{\<br>  if($2 ~ /Variable_name/){\<br>    print “ &lt;————-    “  strftime(“%H:%M:%S”) “    ————-&gt;”;\<br>  }\<br>  if($2 ~ /Questions|Queries|Innodb_rows|Com_select |Com_insert |Com_update |Com_delete |Innodb_buffer_pool_read_requests/)\<br>    print $2 $3;\<br>}’</p>
<p>mysqladmin -P3306 -uroot -p -h127.0.0.1 -r -i 1 ext |\<br>awk -F”|” \<br>“BEGIN{ count=0; }”\<br>‘{ if($2 ~ /Variable_name/ &amp;&amp; ((++count)%20 == 1)){\<br>    print “———-|———|— MySQL Command Status –|—– Innodb row operation —-|– Buffer Pool Read –”;\<br>    print “—Time—|—QPS—|select insert update delete|  read inserted updated deleted|   logical    physical”;\<br>}\<br>else if ($2 ~ /Queries/){queries=$3;}\<br>else if ($2 ~ /Com_select /){com_select=$3;}\<br>else if ($2 ~ /Com_insert /){com_insert=$3;}\<br>else if ($2 ~ /Com_update /){com_update=$3;}\<br>else if ($2 ~ /Com_delete /){com_delete=$3;}\<br>else if ($2 ~ /Innodb_rows_read/){innodb_rows_read=$3;}\<br>else if ($2 ~ /Innodb_rows_deleted/){innodb_rows_deleted=$3;}\<br>else if ($2 ~ /Innodb_rows_inserted/){innodb_rows_inserted=$3;}\<br>else if ($2 ~ /Innodb_rows_updated/){innodb_rows_updated=$3;}\<br>else if ($2 ~ /Innodb_buffer_pool_read_requests/){innodb_lor=$3;}\<br>else if ($2 ~ /Innodb_buffer_pool_reads/){innodb_phr=$3;}\<br>else if ($2 ~ /Uptime / &amp;&amp; count &gt;= 2){\<br>  printf(“ %s |%9d”,strftime(“%H:%M:%S”),queries);\<br>  printf(“|%6d %6d %6d %6d”,com_select,com_insert,com_update,com_delete);\<br>  printf(“|%6d %8d %7d %7d”,innodb_rows_read,innodb_rows_inserted,innodb_rows_updated,innodb_rows_deleted);\<br>  printf(“|%10d %11d\n”,innodb_lor,innodb_phr);\<br>}}’</p>
<p>mysql -u root -p -e ‘show processlist \G’ | grep State | uniq -c | sort -rn<br>```</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.cxlg34.com/2017/05/17/Sql server镜像/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="从心来过">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记忆博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/17/Sql server镜像/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-17T13:33:58+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="镜像数据库"><a href="#镜像数据库" class="headerlink" title="镜像数据库"></a>镜像数据库</h2><ol>
<li>主体库</li>
<li>镜像库</li>
<li>见证服务器</li>
<li>运行模式<br>可故障转移的同步模式<br>不可故障转移的同步模式<br>异步模式<br>第一种模式需要见证服务器 </li>
</ol>
<p>三种模式的主体服务器均需要运行在完整恢复模式下</p>
<h3 id="Sql-server三种恢复模式"><a href="#Sql-server三种恢复模式" class="headerlink" title="Sql server三种恢复模式"></a>Sql server三种恢复模式</h3><ol>
<li>简单恢复模式 checkpoint with truncate log<br>提交完事务截断日志，无法recover in point<br>只能恢复到上一次备份</li>
<li>完整恢复模式 checkpoint without truncate log<br>提交完日志不截断日志，只有在备份过LOG后才可以截断，可以进行recover in point </li>
<li>大容量日志恢复模式<br>对于大量数据操作不记录日志，比如bcp、select into、create|rebuild index等 </li>
</ol>
<h4 id="设置数据库恢复级别"><a href="#设置数据库恢复级别" class="headerlink" title="设置数据库恢复级别"></a>设置数据库恢复级别</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> <span class="keyword">master</span> </div><div class="line"><span class="keyword">go</span> </div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> hxtest <span class="keyword">set</span> <span class="keyword">recovery</span> <span class="keyword">full</span> <span class="keyword">with</span> no_wait; </div><div class="line">go</div></pre></td></tr></table></figure>
<p>一个数据库只能有一个镜像库，如果想创建多个镜像可以采用传送日志加镜像的方法</p>
<h3 id="切换角色"><a href="#切换角色" class="headerlink" title="切换角色"></a>切换角色</h3><ol>
<li>use master<br>go<br>alter database hxtest set partner failover; </li>
<li>ssms</li>
<li>alter database hxtest set force_service_allow_data_loss ;<br>可能丢失数据</li>
</ol>
<h3 id="非域环境检查"><a href="#非域环境检查" class="headerlink" title="非域环境检查"></a>非域环境检查</h3><ol>
<li>Windows 账号。</li>
<li>网络是否能联通，并且端口可用。</li>
<li>主体服务器和镜像服务器的磁盘配置是否正确。</li>
<li>SQL Server版本、补丁是否满足镜像要求。</li>
<li>SQL Server数据库的恢复模式、兼容级别。</li>
<li>SQL Server上是否有常规的备份作业，特别是日志备份。</li>
<li>主体服务器和镜像服务器的SQL Server能否互通。</li>
<li>主体服务器和镜像服务器中是否有共享文件夹。</li>
</ol>
<h4 id="查看文件位置"><a href="#查看文件位置" class="headerlink" title="查看文件位置"></a>查看文件位置</h4><p>use master<br>go<br>select physical_name from<br>sys.master_files<br>where database_id = db_id(‘hxtest’)  </p>
<h4 id="创建主秘钥"><a href="#创建主秘钥" class="headerlink" title="创建主秘钥"></a>创建主秘钥</h4><p>use master<br>go<br>create master key encrytion by password = ‘circ1815’;</p>
<h4 id="删除主秘钥"><a href="#删除主秘钥" class="headerlink" title="删除主秘钥"></a>删除主秘钥</h4><p>use master<br>drop master key ; </p>
<h4 id="创建证书"><a href="#创建证书" class="headerlink" title="创建证书"></a>创建证书</h4><p>use master<br>go<br>create certificate circ_cert<br>with subject = ‘circ_cert’,<br>expiry_date = ‘2020-01-01’;</p>
<h4 id="删除证书"><a href="#删除证书" class="headerlink" title="删除证书"></a>删除证书</h4><p>use master<br>drop certification circ_cert; </p>
<h4 id="使用circ-cert证书创建端点"><a href="#使用circ-cert证书创建端点" class="headerlink" title="使用circ_cert证书创建端点"></a>使用circ_cert证书创建端点</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">IF NOT EXISTS ( <span class="keyword">SELECT</span>  <span class="number">1</span>   </div><div class="line">                <span class="keyword">FROM</span>    sys.database_mirroring_endpoints )   </div><div class="line">    <span class="keyword">BEGIN</span>   </div><div class="line">        <span class="keyword">CREATE</span> ENDPOINT [DatabaseMirroring] STATE = STARTED <span class="keyword">AS</span> TCP ( LISTENER_PORT = <span class="number">5022</span>,   </div><div class="line">            LISTENER_IP = ALL ) <span class="keyword">FOR</span> DATABASE_MIRRORING ( <span class="keyword">AUTHENTICATION</span> =   </div><div class="line">            CERTIFICATE circ_certa, ENCRYPTION = <span class="keyword">REQUIRED</span> Algorithm AES, <span class="keyword">ROLE</span> =   </div><div class="line">            ALL );   </div><div class="line">    <span class="keyword">END</span></div></pre></td></tr></table></figure>
<h4 id="备份证书"><a href="#备份证书" class="headerlink" title="备份证书"></a>备份证书</h4><p>backup certification circ_cert<br>to file ‘d:\data\circ_cert.cert’; </p>
<h4 id="创建Login"><a href="#创建Login" class="headerlink" title="创建Login"></a>创建Login</h4><p>create login replb with password =’Circ1815’;</p>
<h4 id="创建user"><a href="#创建user" class="headerlink" title="创建user"></a>创建user</h4><p>create user replb for loging replb; </p>
<h4 id="使用证书授权用户"><a href="#使用证书授权用户" class="headerlink" title="使用证书授权用户"></a>使用证书授权用户</h4><p>create certificate circ_certb<br>authorization replb<br>from file = ‘c:\data\circ_certb.cert’;</p>
<h4 id="登录账号授权访问端口"><a href="#登录账号授权访问端口" class="headerlink" title="登录账号授权访问端口"></a>登录账号授权访问端口</h4><p>grant connect on endpoint::[DatabaseMirroring] to [replb]</p>
<h4 id="设置伙伴服务器"><a href="#设置伙伴服务器" class="headerlink" title="设置伙伴服务器"></a>设置伙伴服务器</h4><p>alter database hxtest set<br>partner = ‘TCP://win1:5022’ ;</p>
<h3 id="暂停镜像"><a href="#暂停镜像" class="headerlink" title="暂停镜像"></a>暂停镜像</h3><p>alter database hxtest set partner suspend ;<br>alter database hxtest set partner resume ;</p>
<h3 id="镜像监控"><a href="#镜像监控" class="headerlink" title="镜像监控"></a>镜像监控</h3><ol>
<li>监控数据存放在dbm_monitor_data表中 </li>
<li>通过执行sp_dbmmonitorupdate存储过程定期监控 </li>
<li>镜像监控器 </li>
<li>exec sp_dbmmonitoresult; </li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.cxlg34.com/2017/05/17/Mysql日志格式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="从心来过">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记忆博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/17/Mysql日志格式/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-17T13:33:58+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Mysql日志格式"><a href="#Mysql日志格式" class="headerlink" title="Mysql日志格式"></a>Mysql日志格式</h2><h3 id="SBR"><a href="#SBR" class="headerlink" title="SBR"></a>SBR</h3><h3 id="RBR"><a href="#RBR" class="headerlink" title="RBR"></a>RBR</h3><h3 id="Mixed"><a href="#Mixed" class="headerlink" title="Mixed"></a>Mixed</h3><p>Statement模式转Row模式条件：</p>
<ol>
<li>语句包含UUID()</li>
<li>包含auto_increment列的表更新、触发器、存储函数被调用</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.cxlg34.com/2017/05/17/Sql server 2008管理员必备指南笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="从心来过">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记忆博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/17/Sql server 2008管理员必备指南笔记/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-17T13:33:58+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Sql-server-2008笔记"><a href="#Sql-server-2008笔记" class="headerlink" title="Sql server 2008笔记"></a>Sql server 2008笔记</h2><h3 id="截断日志"><a href="#截断日志" class="headerlink" title="截断日志"></a>截断日志</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> hxtest <span class="keyword">set</span>  <span class="keyword">recovery</span> simple ;</div><div class="line">dbcc shrinkfile (hxtest_log,1); </div><div class="line"><span class="keyword">alter</span> <span class="keyword">database</span> hxtest <span class="keyword">set</span> <span class="keyword">recovery</span> <span class="keyword">full</span> ;</div></pre></td></tr></table></figure>
<h3 id="Sql-server-支持的网络协议"><a href="#Sql-server-支持的网络协议" class="headerlink" title="Sql server 支持的网络协议"></a>Sql server 支持的网络协议</h3><ol>
<li>Shared Memory</li>
<li>Named pipes </li>
<li>TCP/IP</li>
<li>VIA协议<br>使用网卡的物理地址和端口号配置Sql server服务<br>多用于局域网</li>
</ol>
<h4 id="局域网使用命名管道"><a href="#局域网使用命名管道" class="headerlink" title="局域网使用命名管道"></a>局域网使用命名管道</h4><pre><code>net use \\10.201.241.155\ipc$
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.cxlg34.com/2017/05/17/Innodb buffer pool configuration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="从心来过">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记忆博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/17/Innodb buffer pool configuration/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-17T13:33:58+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>innodb_buffer_pool_size </li>
<li>innodb_buffer_pool_chunk_size</li>
<li>innodb_buffer_pool_instances</li>
<li>innodb_old_blocks_pct</li>
<li>innodb_old_blocks_time</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.cxlg34.com/2017/05/17/Ceph deploy安装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="从心来过">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记忆博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/17/Ceph deploy安装/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-17T13:33:58+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>yum install -y <a href="https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm" target="_blank" rel="external">https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</a></p>
<p>[ceph-noarch]<br>name=Ceph noarch packages<br>baseurl=<a href="https://download.ceph.com/rpm-jewel/el7/noarch" target="_blank" rel="external">https://download.ceph.com/rpm-jewel/el7/noarch</a><br>enabled=1<br>gpgcheck=1<br>type=rpm-md<br>gpgkey=<a href="https://download.ceph.com/keys/release.asc" target="_blank" rel="external">https://download.ceph.com/keys/release.asc</a></p>
<p>yum update &amp;&amp; yum install ceph-deploy -y<br>yum install ntp </p>
<p>echo “ceph ALL = (root) NOPASSWD:ALL” | tee /etc/sudoers.d/ceph<br>chmod 440 /etc/sudoers.d/ceph</p>
<p>visudo Defaults:ceph !requiretty</p>
<p>mkdir myceph<br>cd myceph</p>
<p>ceph-deploy purgedata (nodexxx,nodexxx)<br>ceph-deploy forgetkeys </p>
<p>ceph-deploy purge (nodexxx,nodexxx)</p>
<p>osd pool default size = 2</p>
<p>yum install snappy leveldb gdisk python-argparse gperftools-libs<br>yum install python-itsdangerous python-rbd python-rados redhat-lsb-core python-jinja2 hdparm</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.cxlg34.com/2017/05/17/Ceph笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="从心来过">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记忆博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/17/Ceph笔记/" itemprop="url">
                  ceph笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-17T13:33:58+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ceph/" itemprop="url" rel="index">
                    <span itemprop="name">Ceph</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><p>OSD – Object Storage Device </p>
<ol>
<li>负责数据存储、复制、平衡数据分布等功能</li>
<li>提交一些信息给Monitor,比如OSD心跳等</li>
<li>一个集群中至少需要两个OSD保障active+clean健康状态和双副本（默认）数据</li>
</ol>
<p>Monitor</p>
<ol>
<li>维护整个集群的健康状态</li>
<li>包含Monitor Map、OSD Map、PG（placemant group) Map和Crush map </li>
</ol>
<p>MDS – Metadata Server</p>
<ol>
<li>主要保存Ceph文件系统的元数据</li>
<li>块存储、对象存储都不需要MDS</li>
</ol>
<p>至少一个Monitor和至少两个OSD,运行Ceph文件系统的客户端需要使用<br>MDS</p>
<h3 id="Ceph功能"><a href="#Ceph功能" class="headerlink" title="Ceph功能"></a>Ceph功能</h3><ol>
<li>RADOSGW(Reliable、Autonomic、Distributed、Object Storage Gateway)<br>功能基于Libradosgw，提供RESTful协议的网关，兼容S3和Swift接口，可以对接网盘及HLS流媒体应用等</li>
<li>raw 提供裸设备 基于librados，通过Librbd创建一个裸设备,通过qemu或者kvm附加到VM上</li>
<li>文件系统</li>
</ol>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>可以通过两种方式安装：1、ceph-deploy工具自动安装 2、手动安装各种组件 </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.cxlg34.com/2017/05/17/Python自动化模块/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="从心来过">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记忆博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/17/Python自动化模块/" itemprop="url">
                  Python自动化运维
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-17T00:00:00+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/自动化运维/" itemprop="url" rel="index">
                    <span itemprop="name">自动化运维</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="psutil模块"><a href="#psutil模块" class="headerlink" title="psutil模块"></a>psutil模块</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wget https:<span class="comment">//pypi.python.org/packages/source/p/psutil/psutil-2.0.0.tar.gz</span></div><div class="line">tar -xzvf psutil-<span class="number">2.0</span>.<span class="number">0</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></div><div class="line">cd psutil-<span class="number">2.0</span>.<span class="number">0</span></div><div class="line">python setup<span class="selector-class">.py</span> install</div></pre></td></tr></table></figure>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> psutil</div><div class="line"><span class="title">mem</span>=psutil.virtual_memory()</div><div class="line"><span class="title">mem</span>.total,mem.used</div></pre></td></tr></table></figure>
<p>import psutil<br>psutil.cpu_times(percpu=True)<br>psutil.disk_usage(‘/‘)<br>psutil.disk_partitions()<br>psutil.net_io_counters()<br>psutil.pids()<br>psutil.users()</p>
<p>import psutil,datetime<br>datetime.datetime.fromtimestamp(psutil.boot_time()).strftime(“%Y-%m-%d %H:%M:%S”)</p>
<p>psutil.pids()<br>psutil.Process()<br>p=psutil.Process(222)<br>p.name()<br>p.exe()<br>p.cwd()<br>p.status()<br>p.create_time()<br>p.uids()<br>p.gids()<br>p.cpu_times()<br>p.cpu_affinity()<br>p.memory_percert()<br>p.memory_info()<br>p.io_counters()<br>p.connections()</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.cxlg34.com/2017/05/17/Ansible安装配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="从心来过">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记忆博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/17/Ansible安装配置/" itemprop="url">
                  Ansible安装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-17T00:00:00+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ansible/" itemprop="url" rel="index">
                    <span itemprop="name">Ansible</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>控制主机所需组件：</p>
<ol>
<li>Python 2.6及以上版本</li>
<li>paramiko模块(Python连接模块 需安装PyCrypto模块(加密) 支持SSHv2)</li>
<li>PyYAML</li>
<li>Jinja2</li>
<li>httplib2(http客户端程序库)</li>
</ol>
<p>被管节点所需组件：</p>
<ol>
<li>Python 2.4及以上版本(低于2.5需安装python-simplejson)</li>
<li>Windows上需安装Powershell 3.0并授权远程管理</li>
</ol>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/05/17/Ansible安装配置/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="从心来过" />
          <p class="site-author-name" itemprop="name">从心来过</p>
           
              <p class="site-description motion-element" itemprop="description">都付笑谈中</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://www.baidu.com" target="_blank" title="baidu">
                  
                    <i class="fa fa-fw fa-desktop"></i>
                  
                  baidu
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">从心来过</span>
</div>





        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  







  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  

  

  

</body>
</html>
