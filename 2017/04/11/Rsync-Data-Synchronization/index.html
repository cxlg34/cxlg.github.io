<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Rsync,数据同步,单独用户给目录添加特殊权限,无交互备份,SSH密钥,增量备份,文件打包,后台运行," />





  <link rel="alternate" href="/atom.xml" title="记忆博客" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="安装程序yum install -y rsync xinetd 激活rsyncvim /etc/xinetd.d/rsync1234567891011service rsync&amp;#123;        disable = no        flags           = IPv6        socket_type     = stream        wait">
<meta name="keywords" content="Rsync,数据同步,单独用户给目录添加特殊权限,无交互备份,SSH密钥,增量备份,文件打包,后台运行">
<meta property="og:type" content="article">
<meta property="og:title" content="Rsync Data Synchronization">
<meta property="og:url" content="http://www.cxlg34.com/2017/04/11/Rsync-Data-Synchronization/index.html">
<meta property="og:site_name" content="记忆博客">
<meta property="og:description" content="安装程序yum install -y rsync xinetd 激活rsyncvim /etc/xinetd.d/rsync1234567891011service rsync&amp;#123;        disable = no        flags           = IPv6        socket_type     = stream        wait">
<meta property="og:updated_time" content="2017-04-11T15:03:26.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Rsync Data Synchronization">
<meta name="twitter:description" content="安装程序yum install -y rsync xinetd 激活rsyncvim /etc/xinetd.d/rsync1234567891011service rsync&amp;#123;        disable = no        flags           = IPv6        socket_type     = stream        wait">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"hide","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.cxlg34.com/2017/04/11/Rsync-Data-Synchronization/"/>





  <title> Rsync Data Synchronization | 记忆博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">记忆博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">记录点滴</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://www.cxlg34.com/2017/04/11/Rsync-Data-Synchronization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="从心来过">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记忆博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Rsync Data Synchronization
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-11T23:02:35+08:00">
                2017-04-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LINUX/" itemprop="url" rel="index">
                    <span itemprop="name">LINUX</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="安装程序"><a href="#安装程序" class="headerlink" title="安装程序"></a>安装程序</h2><p><code>yum install -y rsync xinetd</code></p>
<h2 id="激活rsync"><a href="#激活rsync" class="headerlink" title="激活rsync"></a>激活rsync</h2><p><code>vim /etc/xinetd.d/rsync</code><br><figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">service rsync</div><div class="line">&#123;</div><div class="line">        <span class="attr">disable</span> = no</div><div class="line">        <span class="attr">flags</span>           = IPv6</div><div class="line">        <span class="attr">socket_type</span>     = stream</div><div class="line">        <span class="attr">wait</span>            = no</div><div class="line">        <span class="attr">user</span>            = root</div><div class="line">        <span class="attr">server</span>          = /usr/bin/rsync</div><div class="line">        <span class="attr">server_args</span>     = --daemon</div><div class="line">        log_on_failure  += USERID</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">[root@localhost ~]</span># /etc/init.d/xinetd start</div><div class="line">Starting xinetd:                                           <span class="string">[  OK  ]</span></div></pre></td></tr></table></figure>
<h2 id="查看服务"><a href="#查看服务" class="headerlink" title="查看服务"></a>查看服务</h2><figure class="highlight julia"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root<span class="meta">@localhost</span> ~]<span class="comment"># netstat -antup | grep 873</span></div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="type">::</span>:<span class="number">873</span>                      <span class="type">::</span>:*                        LISTEN      <span class="number">2611</span>/xinetd</div></pre></td></tr></table></figure>
<h2 id="创建上传和下载用户"><a href="#创建上传和下载用户" class="headerlink" title="创建上传和下载用户"></a>创建上传和下载用户</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root<span class="symbol">@localhost</span> html]<span class="meta"># useradd rget</span></div><div class="line">[root<span class="symbol">@localhost</span> html]<span class="meta"># echo <span class="string">'123456'</span> | passwd --stdin rget</span></div><div class="line">Changing password <span class="keyword">for</span> user rget.</div><div class="line">passwd: all authentication tokens updated successfully.</div><div class="line">[root<span class="symbol">@localhost</span> html]<span class="meta"># useradd rput                       </span></div><div class="line">[root<span class="symbol">@localhost</span> html]<span class="meta"># echo <span class="string">'123456'</span> | passwd --stdin rput</span></div><div class="line">Changing password <span class="keyword">for</span> user rput.</div><div class="line">passwd: all authentication tokens updated successfully.</div></pre></td></tr></table></figure>
<h2 id="单独用户给目录添加权限"><a href="#单独用户给目录添加权限" class="headerlink" title="单独用户给目录添加权限"></a>单独用户给目录添加权限</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root<span class="variable">@localhost</span> html]<span class="comment"># ll -d /var/www/html/</span></div><div class="line">drwxr-xr-x. <span class="number">2</span> root root <span class="number">4096</span> Oct <span class="number">16</span>  <span class="number">2014</span> /var/www/html/</div><div class="line">[root<span class="variable">@localhost</span> html]<span class="comment"># setfacl -R -m user:rput:rwx /var/www/html/</span></div><div class="line">[root<span class="variable">@localhost</span> html]<span class="comment"># setfacl -R -m default:rput:rwx /var/www/html/  </span></div><div class="line">[root<span class="variable">@localhost</span> html]<span class="comment"># setfacl -R -m user:rget:rwx /var/www/html/      </span></div><div class="line">[root<span class="variable">@localhost</span> html]<span class="comment"># setfacl -R -m default:rget:rwx /var/www/html/         </span></div><div class="line">[root<span class="variable">@localhost</span> html]<span class="comment"># getfacl /var/www/html/</span></div><div class="line"><span class="symbol">getfacl:</span> Removing leading <span class="string">'/'</span> from absolute path names</div><div class="line"><span class="comment"># file: var/www/html/</span></div><div class="line"><span class="comment"># owner: root</span></div><div class="line"><span class="comment"># group: root</span></div><div class="line"><span class="symbol">user:</span><span class="symbol">:rwx</span></div><div class="line"><span class="symbol">user:</span><span class="symbol">rget:</span>rwx</div><div class="line"><span class="symbol">user:</span><span class="symbol">rput:</span>rwx</div><div class="line"><span class="symbol">group:</span><span class="symbol">:r-x</span></div><div class="line"><span class="symbol">mask:</span><span class="symbol">:rwx</span></div><div class="line"><span class="symbol">other:</span><span class="symbol">:r-x</span></div><div class="line"><span class="symbol">default:</span><span class="symbol">user:</span><span class="symbol">:rwx</span></div><div class="line"><span class="symbol">default:</span><span class="symbol">user:</span><span class="symbol">rget:</span>rwx</div><div class="line"><span class="symbol">default:</span><span class="symbol">user:</span><span class="symbol">rput:</span>rwx</div><div class="line"><span class="symbol">default:</span><span class="symbol">group:</span><span class="symbol">:r-x</span></div><div class="line"><span class="symbol">default:</span><span class="symbol">mask:</span><span class="symbol">:rwx</span></div><div class="line"><span class="symbol">default:</span><span class="symbol">other:</span><span class="symbol">:r-x</span></div></pre></td></tr></table></figure>
<h2 id="源服务器创建测试数据"><a href="#源服务器创建测试数据" class="headerlink" title="源服务器创建测试数据"></a>源服务器创建测试数据</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost html]# cp -r <span class="regexp">/boot/g</span>rub<span class="regexp">/ /</span>var<span class="regexp">/www/</span>html<span class="regexp">/</span></div></pre></td></tr></table></figure>
<h2 id="备份服务器创建备份目录"><a href="#备份服务器创建备份目录" class="headerlink" title="备份服务器创建备份目录"></a>备份服务器创建备份目录</h2><p><code>[root@localhost ~]# mkdir /backup</code></p>
<h2 id="用命令执行备份"><a href="#用命令执行备份" class="headerlink" title="用命令执行备份"></a>用命令执行备份</h2><p><code>若有报错需查看源服务器文件或文件夹的权限</code><br><figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># rsync -azP --delete rget@192.168.134.137:/var/www/html/ /backup/</span></div><div class="line">rget@192.168.134.137's password: </div><div class="line">receiving incremental file list</div><div class="line">./</div><div class="line">grub/</div><div class="line">grub/device.map</div><div class="line">         <span class="number"> 63 </span>100%   61.52kB/s    0:00:00 (xfer<span class="comment">#1, to-check=15/18)</span></div><div class="line">grub/e2fs_stage1_5</div><div class="line">      <span class="number"> 13396 </span>100%    6.39MB/s    0:00:00 (xfer<span class="comment">#2, to-check=14/18)</span></div><div class="line">grub/fat_stage1_5</div><div class="line">      <span class="number"> 12636 </span>100%    6.03MB/s    0:00:00 (xfer<span class="comment">#3, to-check=13/18)</span></div><div class="line">grub/ffs_stage1_5</div><div class="line">      <span class="number"> 11780 </span>100%    3.74MB/s    0:00:00 (xfer<span class="comment">#4, to-check=12/18)</span></div><div class="line">grub/grub.conf</div><div class="line">        <span class="number"> 771 </span>100%  250.98kB/s    0:00:00 (xfer<span class="comment">#5, to-check=11/18)</span></div><div class="line">grub/iso9660_stage1_5</div><div class="line">      <span class="number"> 11772 </span>100%    2.81MB/s    0:00:00 (xfer<span class="comment">#6, to-check=10/18)</span></div><div class="line">grub/jfs_stage1_5</div><div class="line">      <span class="number"> 13284 </span>100%    2.53MB/s    0:00:00 (xfer<span class="comment">#7, to-check=9/18)</span></div><div class="line">grub/menu.lst -&gt; ./grub.conf</div><div class="line">grub/minix_stage1_5</div><div class="line">      <span class="number"> 11972 </span>100%    1.90MB/s    0:00:00 (xfer<span class="comment">#8, to-check=7/18)</span></div><div class="line">grub/reiserfs_stage1_5</div><div class="line">      <span class="number"> 14428 </span>100%    1.53MB/s    0:00:00 (xfer<span class="comment">#9, to-check=6/18)</span></div><div class="line">grub/splash.xpm.gz</div><div class="line">       <span class="number"> 1341 </span>100%  145.51kB/s    0:00:00 (xfer<span class="comment">#10, to-check=5/18)</span></div><div class="line">grub/stage1</div><div class="line">        <span class="number"> 512 </span>100%   55.56kB/s    0:00:00 (xfer<span class="comment">#11, to-check=4/18)</span></div><div class="line">grub/stage2</div><div class="line">     <span class="number"> 126116 </span>100%    7.52MB/s    0:00:00 (xfer<span class="comment">#12, to-check=3/18)</span></div><div class="line">grub/ufs2_stage1_5</div><div class="line">      <span class="number"> 12040 </span>100%  691.64kB/s    0:00:00 (xfer<span class="comment">#13, to-check=2/18)</span></div><div class="line">grub/vstafs_stage1_5</div><div class="line">      <span class="number"> 11380 </span>100%  653.72kB/s    0:00:00 (xfer<span class="comment">#14, to-check=1/18)</span></div><div class="line">grub/xfs_stage1_5</div><div class="line">      <span class="number"> 13980 </span>100%  758.46kB/s    0:00:00 (xfer<span class="comment">#15, to-check=0/18)</span></div><div class="line"></div><div class="line">sent<span class="number"> 306 </span>bytes  received<span class="number"> 148745 </span>bytes  42586.00 bytes/sec</div><div class="line">total size is<span class="number"> 255482 </span> speedup is 1.71</div></pre></td></tr></table></figure></p>
<h2 id="SSH密钥无交互备份"><a href="#SSH密钥无交互备份" class="headerlink" title="SSH密钥无交互备份"></a>SSH密钥无交互备份</h2><p><code>备份服务器创建密钥对</code></p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root<span class="meta">@localhost</span> ~]<span class="comment"># ssh-keygen </span></div><div class="line">Generating public/private rsa key pair.</div><div class="line">Enter file in which to save the key (/root/.ssh/id_rsa): </div><div class="line">Enter passphrase (empty for no passphrase): </div><div class="line">Enter same passphrase again: </div><div class="line">Your identification has been saved in /root/.ssh/id_rsa.</div><div class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</div><div class="line">The key fingerprint is:</div><div class="line">47:39:61:7d:44:1c:a5:50:82:fe:5c:f4:54:2d:d7:88 root<span class="meta">@localhost.localdomain</span></div><div class="line">The key's randomart image is:</div><div class="line">+--[ RSA 2048]----+</div><div class="line">|<span class="string">          ooo*=+*</span>|</div><div class="line">|<span class="string">         ..oEo*.=</span>|</div><div class="line">|<span class="string">         .+  o.= </span>|</div><div class="line">|<span class="string">         ...  . .</span>|</div><div class="line">|<span class="string">        S .o .   </span>|</div><div class="line">|<span class="string">         .  o    </span>|</div><div class="line">|<span class="string">                 </span>|</div><div class="line">|<span class="string">                 </span>|</div><div class="line">|<span class="string">                 </span>|</div><div class="line">+-----------------+</div></pre></td></tr></table></figure>
<h2 id="拷贝密钥到源服务器"><a href="#拷贝密钥到源服务器" class="headerlink" title="拷贝密钥到源服务器"></a>拷贝密钥到源服务器</h2><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="meta"># ssh-copy-id rget@192.168.134.137</span></div><div class="line">rget@<span class="number">192.168</span><span class="number">.134</span><span class="number">.137</span><span class="comment">'s password: </span></div><div class="line">Now <span class="keyword">try</span> logging <span class="keyword">into</span> the machine, <span class="keyword">with</span> <span class="string">"ssh 'rget@192.168.134.137'"</span>, <span class="keyword">and</span> check <span class="keyword">in</span>:</div><div class="line">  .ssh/authorized_keys</div><div class="line"><span class="keyword">to</span> make sure we haven<span class="comment">'t added extra keys that you weren't expecting.</span></div></pre></td></tr></table></figure>
<h2 id="测试无交互登录"><a href="#测试无交互登录" class="headerlink" title="测试无交互登录"></a>测试无交互登录</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">ssh</span> <span class="selector-tag">rget</span>@<span class="keyword">192</span>.<span class="keyword">168</span>.<span class="keyword">134</span>.<span class="keyword">137</span></div><div class="line">[rget@localhost ~]$</div></pre></td></tr></table></figure>
<h2 id="测试同步"><a href="#测试同步" class="headerlink" title="测试同步"></a>测试同步</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># rsync -azP --delete rget@192.168.134.137:/var/www/html/ /backup/</span></div><div class="line">Address <span class="number">192.168</span><span class="number">.134</span><span class="number">.137</span> maps <span class="keyword">to</span> localhost, <span class="keyword">but</span> this <span class="keyword">does</span> <span class="keyword">not</span> map <span class="keyword">back</span> <span class="keyword">to</span> <span class="keyword">the</span> address - POSSIBLE BREAK-IN ATTEMPT!</div><div class="line">receiving incremental <span class="built_in">file</span> <span class="built_in">list</span></div><div class="line"></div><div class="line">sent <span class="number">12</span> bytes  received <span class="number">355</span> bytes  <span class="number">244.67</span> bytes/sec</div><div class="line">total size <span class="keyword">is</span> <span class="number">255482</span>  speedup <span class="keyword">is</span> <span class="number">696.14</span></div></pre></td></tr></table></figure>
<h2 id="编写脚本测试且查看结果"><a href="#编写脚本测试且查看结果" class="headerlink" title="编写脚本测试且查看结果"></a>编写脚本测试且查看结果</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># cat &gt;&gt; /root/rget.sh &lt;&lt; EOF</span></div><div class="line">&gt; <span class="comment">#!/bin/bash</span></div><div class="line">&gt; <span class="comment"># rsync and ssh key get backup</span></div><div class="line">&gt; rsync -az --delete rget<span class="variable">@192</span>.<span class="number">168.134</span>.<span class="number">137</span><span class="symbol">:/var/www/html/</span> /backup/ </div><div class="line">&gt; EOF</div><div class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># chmod +x /root/rget.sh </span></div><div class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># rm -rf /backup/*</span></div><div class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># /root/rget.sh</span></div><div class="line">Address <span class="number">192.168</span>.<span class="number">134.137</span> maps to localhost, but this does <span class="keyword">not</span> map back to the address - POSSIBLE BREAK-IN ATTEMPT!</div><div class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># ll /backup/</span></div><div class="line">total <span class="number">4</span></div><div class="line">drwxr-xr-x. <span class="number">2</span> root root <span class="number">4096</span> Sep <span class="number">13</span> 09<span class="symbol">:</span><span class="number">50</span> grub</div></pre></td></tr></table></figure>
<h2 id="定期增量备份"><a href="#定期增量备份" class="headerlink" title="定期增量备份"></a>定期增量备份</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># crontab -e</span></div><div class="line"><span class="number">01</span> <span class="number">3</span> * * * <span class="regexp">/root/rget</span>.sh &amp;</div></pre></td></tr></table></figure>
<h2 id="备份之后打包"><a href="#备份之后打包" class="headerlink" title="备份之后打包"></a>备份之后打包</h2><figure class="highlight cos"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -cvzf `date +<span class="built_in">%Y</span>-<span class="built_in">%m</span>-<span class="built_in">%d</span>-<span class="built_in">%H</span><span class="built_in">%M</span><span class="built_in">%S</span>` /backup/</div></pre></td></tr></table></figure>
<h2 id="使用非系统用户进行备份"><a href="#使用非系统用户进行备份" class="headerlink" title="使用非系统用户进行备份"></a>使用非系统用户进行备份</h2><p><code>服务端创建全局配置文件</code><br><figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># touch /etc/rsyncd.conf</span></div><div class="line">[root@localhost ~]<span class="comment"># cat &gt;&gt; /etc/rsyncd.conf &lt;&lt; EOF</span></div><div class="line">&gt; <span class="attr">uid=nobody</span></div><div class="line">&gt; <span class="attr">gid=nobody</span></div><div class="line">&gt; <span class="attr">address</span> = <span class="number">192.168</span>.<span class="number">134.137</span></div><div class="line">&gt; <span class="attr">port=873</span></div><div class="line">&gt; hosts <span class="attr">allow=</span> <span class="number">192.168</span>.<span class="number">134.143</span> </div><div class="line">&gt; <span class="comment">#hosts deny=0.0.0.0/32</span></div><div class="line">&gt; use <span class="attr">chroot=yes</span></div><div class="line">&gt; max <span class="attr">connections=5</span></div><div class="line">&gt; pid <span class="attr">file=/var/run/rsyncd.pid</span></div><div class="line">&gt; lock <span class="attr">file=/var/run/rsync.lock</span> </div><div class="line">&gt; log <span class="attr">file=/var/log/rsyncd.log</span> </div><div class="line">&gt; motd <span class="attr">file=/etc/rsyncd.motd</span> </div><div class="line">&gt; </div><div class="line">&gt; [wwwroot]       </div><div class="line">&gt; <span class="attr">path=/var/www/html</span></div><div class="line">&gt; <span class="attr">comment=rsync</span> wwwroot</div><div class="line">&gt; read <span class="attr">only=yes</span></div><div class="line">&gt; <span class="attr">list=yes</span></div><div class="line">&gt; auth <span class="attr">users=backuper</span></div><div class="line">&gt; secrets <span class="attr">file=/etc/rsync.passwd</span></div><div class="line">&gt; EOF</div></pre></td></tr></table></figure></p>
<p><code>创建提示信息文件和创建密码文件</code><br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># grep motd /etc/rsyncd.conf </span></div><div class="line">motd file=<span class="regexp">/etc/rsyncd</span>.motd </div><div class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># echo "Welcome to backup server" &gt; /etc/rsyncd.motd</span></div><div class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># grep passwd /etc/rsyncd.conf </span></div><div class="line">secrets file=<span class="regexp">/etc/rsync</span>.passwd</div><div class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># cat &gt;&gt; /etc/rsync.passwd &lt;&lt; EOF</span></div><div class="line">&gt; <span class="symbol">backup:</span><span class="number">123456</span></div><div class="line">&gt; EOF</div><div class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># cat  /etc/rsync.passwd</span></div><div class="line"><span class="symbol">backup:</span><span class="number">123456</span></div></pre></td></tr></table></figure></p>
<p><code>测试备份</code><br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="selector-attr">[root@localhost ~]</span># <span class="selector-tag">rsync</span> <span class="selector-tag">-azP</span> <span class="selector-tag">backup</span>@<span class="selector-tag">192</span><span class="selector-class">.168</span><span class="selector-class">.134</span><span class="selector-class">.137</span><span class="selector-pseudo">::wwwroot</span> /<span class="selector-tag">backup</span>/</div><div class="line"><span class="selector-tag">backup</span> <span class="selector-tag">server</span></div><div class="line"></div><div class="line"><span class="selector-tag">Password</span>: </div><div class="line"><span class="selector-tag">receiving</span> <span class="selector-tag">incremental</span> <span class="selector-tag">file</span> <span class="selector-tag">list</span></div><div class="line">./</div><div class="line"><span class="selector-tag">grub</span>/</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">device</span><span class="selector-class">.map</span></div><div class="line">          <span class="selector-tag">63</span> <span class="selector-tag">100%</span>   <span class="selector-tag">61</span><span class="selector-class">.52kB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#1</span>, to-check=<span class="number">15</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">e2fs_stage1_5</span></div><div class="line">       <span class="selector-tag">13396</span> <span class="selector-tag">100%</span>   <span class="selector-tag">12</span><span class="selector-class">.78MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#2</span>, to-check=<span class="number">14</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">fat_stage1_5</span></div><div class="line">       <span class="selector-tag">12636</span> <span class="selector-tag">100%</span>   <span class="selector-tag">12</span><span class="selector-class">.05MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#3</span>, to-check=<span class="number">13</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">ffs_stage1_5</span></div><div class="line">       <span class="selector-tag">11780</span> <span class="selector-tag">100%</span>   <span class="selector-tag">11</span><span class="selector-class">.23MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#4</span>, to-check=<span class="number">12</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">grub</span><span class="selector-class">.conf</span></div><div class="line">         <span class="selector-tag">771</span> <span class="selector-tag">100%</span>  <span class="selector-tag">752</span><span class="selector-class">.93kB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#5</span>, to-check=<span class="number">11</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">iso9660_stage1_5</span></div><div class="line">       <span class="selector-tag">11772</span> <span class="selector-tag">100%</span>   <span class="selector-tag">11</span><span class="selector-class">.23MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#6</span>, to-check=<span class="number">10</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">jfs_stage1_5</span></div><div class="line">       <span class="selector-tag">13284</span> <span class="selector-tag">100%</span>    <span class="selector-tag">6</span><span class="selector-class">.33MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#7</span>, to-check=<span class="number">9</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">menu</span><span class="selector-class">.lst</span> <span class="selector-tag">-</span>&gt; ./<span class="selector-tag">grub</span><span class="selector-class">.conf</span></div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">minix_stage1_5</span></div><div class="line">       <span class="selector-tag">11972</span> <span class="selector-tag">100%</span>    <span class="selector-tag">5</span><span class="selector-class">.71MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#8</span>, to-check=<span class="number">7</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">reiserfs_stage1_5</span></div><div class="line">       <span class="selector-tag">14428</span> <span class="selector-tag">100%</span>    <span class="selector-tag">1</span><span class="selector-class">.72MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#9</span>, to-check=<span class="number">6</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">splash</span><span class="selector-class">.xpm</span><span class="selector-class">.gz</span></div><div class="line">        <span class="selector-tag">1341</span> <span class="selector-tag">100%</span>  <span class="selector-tag">163</span><span class="selector-class">.70kB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#10</span>, to-check=<span class="number">5</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">stage1</span></div><div class="line">         <span class="selector-tag">512</span> <span class="selector-tag">100%</span>   <span class="selector-tag">62</span><span class="selector-class">.50kB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#11</span>, to-check=<span class="number">4</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">stage2</span></div><div class="line">      <span class="selector-tag">126116</span> <span class="selector-tag">100%</span>    <span class="selector-tag">7</span><span class="selector-class">.52MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#12</span>, to-check=<span class="number">3</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">ufs2_stage1_5</span></div><div class="line">       <span class="selector-tag">12040</span> <span class="selector-tag">100%</span>  <span class="selector-tag">691</span><span class="selector-class">.64kB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#13</span>, to-check=<span class="number">2</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">vstafs_stage1_5</span></div><div class="line">       <span class="selector-tag">11380</span> <span class="selector-tag">100%</span>  <span class="selector-tag">617</span><span class="selector-class">.40kB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#14</span>, to-check=<span class="number">1</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">xfs_stage1_5</span></div><div class="line">       <span class="selector-tag">13980</span> <span class="selector-tag">100%</span>  <span class="selector-tag">718</span><span class="selector-class">.54kB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#15</span>, to-check=<span class="number">0</span>/<span class="number">18</span>)</div><div class="line"></div><div class="line"><span class="selector-tag">sent</span> <span class="selector-tag">354</span> <span class="selector-tag">bytes</span>  <span class="selector-tag">received</span> <span class="selector-tag">148823</span> <span class="selector-tag">bytes</span>  <span class="selector-tag">22950</span><span class="selector-class">.31</span> <span class="selector-tag">bytes</span>/<span class="selector-tag">sec</span></div><div class="line"><span class="selector-tag">total</span> <span class="selector-tag">size</span> <span class="selector-tag">is</span> <span class="selector-tag">255482</span>  <span class="selector-tag">speedup</span> <span class="selector-tag">is</span> <span class="selector-tag">1</span><span class="selector-class">.71</span></div></pre></td></tr></table></figure></p>
<p><code>实现无交亏脚本</code><br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># export RSYNC_PASSWORD=123456</span></div><div class="line">[root@localhost ~]<span class="comment"># rsync -azP backup@192.168.134.137::wwwroot /backup/</span></div><div class="line">backup server</div><div class="line"></div><div class="line">receiving incremental <span class="built_in">file</span> <span class="built_in">list</span></div><div class="line"></div><div class="line">sent <span class="number">60</span> bytes  received <span class="number">433</span> bytes  <span class="number">986.00</span> bytes/sec</div><div class="line">total size <span class="keyword">is</span> <span class="number">255482</span>  speedup <span class="keyword">is</span> <span class="number">518.22</span></div></pre></td></tr></table></figure></p>
<p><code>脚本</code><br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># cat &gt;&gt; backup.sh &lt;&lt; EOF</span></div><div class="line">&gt; <span class="comment">#!/bin/bash</span></div><div class="line">&gt; <span class="keyword">export</span> RSYNC_PASSWORD=<span class="number">123456</span></div><div class="line">&gt; rsync -azP backup@<span class="number">192.168</span><span class="number">.134</span><span class="number">.137</span>::wwwroot <span class="regexp">/backup/</span></div><div class="line">&gt; EOF</div><div class="line">[root@localhost ~]<span class="comment"># chmod +x backup.sh </span></div><div class="line">[root@localhost ~]<span class="comment"># rm -rf /backup/*</span></div></pre></td></tr></table></figure></p>
<p><code>验证</code><br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="selector-attr">[root@localhost ~]</span># ./<span class="selector-tag">backup</span><span class="selector-class">.sh</span> </div><div class="line"><span class="selector-tag">backup</span> <span class="selector-tag">server</span></div><div class="line"></div><div class="line"><span class="selector-tag">receiving</span> <span class="selector-tag">incremental</span> <span class="selector-tag">file</span> <span class="selector-tag">list</span></div><div class="line">./</div><div class="line"><span class="selector-tag">grub</span>/</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">device</span><span class="selector-class">.map</span></div><div class="line">          <span class="selector-tag">63</span> <span class="selector-tag">100%</span>   <span class="selector-tag">61</span><span class="selector-class">.52kB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#1</span>, to-check=<span class="number">15</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">e2fs_stage1_5</span></div><div class="line">       <span class="selector-tag">13396</span> <span class="selector-tag">100%</span>    <span class="selector-tag">6</span><span class="selector-class">.39MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#2</span>, to-check=<span class="number">14</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">fat_stage1_5</span></div><div class="line">       <span class="selector-tag">12636</span> <span class="selector-tag">100%</span>    <span class="selector-tag">4</span><span class="selector-class">.02MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#3</span>, to-check=<span class="number">13</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">ffs_stage1_5</span></div><div class="line">       <span class="selector-tag">11780</span> <span class="selector-tag">100%</span>    <span class="selector-tag">2</span><span class="selector-class">.81MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#4</span>, to-check=<span class="number">12</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">grub</span><span class="selector-class">.conf</span></div><div class="line">         <span class="selector-tag">771</span> <span class="selector-tag">100%</span>  <span class="selector-tag">188</span><span class="selector-class">.23kB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#5</span>, to-check=<span class="number">11</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">iso9660_stage1_5</span></div><div class="line">       <span class="selector-tag">11772</span> <span class="selector-tag">100%</span>    <span class="selector-tag">2</span><span class="selector-class">.25MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#6</span>, to-check=<span class="number">10</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">jfs_stage1_5</span></div><div class="line">       <span class="selector-tag">13284</span> <span class="selector-tag">100%</span>    <span class="selector-tag">2</span><span class="selector-class">.11MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#7</span>, to-check=<span class="number">9</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">menu</span><span class="selector-class">.lst</span> <span class="selector-tag">-</span>&gt; ./<span class="selector-tag">grub</span><span class="selector-class">.conf</span></div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">minix_stage1_5</span></div><div class="line">       <span class="selector-tag">11972</span> <span class="selector-tag">100%</span>    <span class="selector-tag">1</span><span class="selector-class">.63MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#8</span>, to-check=<span class="number">7</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">reiserfs_stage1_5</span></div><div class="line">       <span class="selector-tag">14428</span> <span class="selector-tag">100%</span>    <span class="selector-tag">1</span><span class="selector-class">.38MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#9</span>, to-check=<span class="number">6</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">splash</span><span class="selector-class">.xpm</span><span class="selector-class">.gz</span></div><div class="line">        <span class="selector-tag">1341</span> <span class="selector-tag">100%</span>  <span class="selector-tag">119</span><span class="selector-class">.05kB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#10</span>, to-check=<span class="number">5</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">stage1</span></div><div class="line">         <span class="selector-tag">512</span> <span class="selector-tag">100%</span>   <span class="selector-tag">45</span><span class="selector-class">.45kB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#11</span>, to-check=<span class="number">4</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">stage2</span></div><div class="line">      <span class="selector-tag">126116</span> <span class="selector-tag">100%</span>    <span class="selector-tag">6</span><span class="selector-class">.33MB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#12</span>, to-check=<span class="number">3</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">ufs2_stage1_5</span></div><div class="line">       <span class="selector-tag">12040</span> <span class="selector-tag">100%</span>  <span class="selector-tag">587</span><span class="selector-class">.89kB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#13</span>, to-check=<span class="number">2</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">vstafs_stage1_5</span></div><div class="line">       <span class="selector-tag">11380</span> <span class="selector-tag">100%</span>  <span class="selector-tag">555</span><span class="selector-class">.66kB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#14</span>, to-check=<span class="number">1</span>/<span class="number">18</span>)</div><div class="line"><span class="selector-tag">grub</span>/<span class="selector-tag">xfs_stage1_5</span></div><div class="line">       <span class="selector-tag">13980</span> <span class="selector-tag">100%</span>  <span class="selector-tag">650</span><span class="selector-class">.11kB</span>/<span class="selector-tag">s</span>    <span class="selector-tag">0</span><span class="selector-pseudo">:00</span><span class="selector-pseudo">:00</span> (xfer<span class="number">#15</span>, to-check=<span class="number">0</span>/<span class="number">18</span>)</div><div class="line"></div><div class="line"><span class="selector-tag">sent</span> <span class="selector-tag">354</span> <span class="selector-tag">bytes</span>  <span class="selector-tag">received</span> <span class="selector-tag">148823</span> <span class="selector-tag">bytes</span>  <span class="selector-tag">99451</span><span class="selector-class">.33</span> <span class="selector-tag">bytes</span>/<span class="selector-tag">sec</span></div><div class="line"><span class="selector-tag">total</span> <span class="selector-tag">size</span> <span class="selector-tag">is</span> <span class="selector-tag">255482</span>  <span class="selector-tag">speedup</span> <span class="selector-tag">is</span> <span class="selector-tag">1</span><span class="selector-class">.71</span></div></pre></td></tr></table></figure></p>
<h2 id="rsync-amp-inotify实时同步"><a href="#rsync-amp-inotify实时同步" class="headerlink" title="rsync&amp;inotify实时同步"></a>rsync&amp;inotify实时同步</h2><p><code>查看内核是否支持infotify，kernel 2.6.13开始正式并入内核。</code><br><figure class="highlight tcl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# uname -r</div><div class="line"><span class="number">2.6</span><span class="number">.32</span><span class="number">-504.</span>el6.x86_64</div><div class="line">[root@localhost ~]# ll /<span class="keyword">proc</span>/sys/fs/inotify/<span class="title"></span></div><div class="line">total 0</div><div class="line">-rw-r--r-- 1<span class="title"> root</span> root 0<span class="title"> Sep</span> 14 02:51<span class="title"> max_queued_events</span></div><div class="line">-rw-r--r-- 1<span class="title"> root</span> root 0<span class="title"> Sep</span> 14 02:51<span class="title"> max_user_instances</span></div><div class="line">-rw-r--r-- 1<span class="title"> root</span> root 0<span class="title"> Sep</span> 14 02:51<span class="title"> max_user_watches</span></div><div class="line"></div><div class="line">----------</div><div class="line">#表示监控事件队列<span class="title">	max_queued_events</span></div><div class="line">#表示最多监控实例数<span class="title">	max_user_instances</span></div><div class="line">#表示每个实例最多监控文件数<span class="title">	max_user_watches</span></div><div class="line">----------</div><div class="line"></div><div class="line">[root@localhost ~]#<span class="title"> cat</span> &gt;&gt; /etc/sysctl.conf &lt;&lt;<span class="title"> EOF</span></div><div class="line">&gt;<span class="title"> fs.inotify.max_queued_events</span> = 32768</div><div class="line">&gt;<span class="title"> fs.inotify.max_user_instances</span> = 1024</div><div class="line">&gt;<span class="title"> fs.inotify.max_user_watches</span> = 90000000</div><div class="line">&gt;<span class="title"> EOF</span></div><div class="line">[root@localhost ~]#<span class="title"> sysctl</span> -p<span class="title"></span></div><div class="line">net.ipv4.ip_forward = 0<span class="title"></span></div><div class="line">net.ipv4.conf.default.rp_filter = 1<span class="title"></span></div><div class="line">net.ipv4.conf.default.accept_source_route = 0<span class="title"></span></div><div class="line">kernel.sysrq = 0<span class="title"></span></div><div class="line">kernel.core_uses_pid = 1<span class="title"></span></div><div class="line">net.ipv4.tcp_syncookies = 1<span class="title"></span></div><div class="line">net.bridge.bridge-nf-call-ip6tables = 0<span class="title"></span></div><div class="line">net.bridge.bridge-nf-call-iptables = 0<span class="title"></span></div><div class="line">net.bridge.bridge-nf-call-arptables = 0<span class="title"></span></div><div class="line">kernel.msgmnb = 65536<span class="title"></span></div><div class="line">kernel.msgmax = 65536<span class="title"></span></div><div class="line">kernel.shmmax = 68719476736<span class="title"></span></div><div class="line">kernel.shmall = 4294967296<span class="title"></span></div><div class="line">fs.inotify.max_queued_events = 32768<span class="title"></span></div><div class="line">fs.inotify.max_user_instances = 1024<span class="title"></span></div><div class="line">fs.inotify.max_user_watches = 90000000</div></pre></td></tr></table></figure></p>
<p><code>安装inotify</code><br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta"># 下载 inotify-tools-3.13.tar.gz</span></div><div class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># tar -zxvf inotify-tools-3.13.tar.gz </span></div><div class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># cd inotify-tools-3.13</span></div><div class="line">[root<span class="symbol">@localhost</span> inotify-tools<span class="number">-3.13</span>]<span class="meta"># ./configure</span></div><div class="line"><span class="meta"># 用4个CPU编译</span></div><div class="line">[root<span class="symbol">@localhost</span> inotify-tools<span class="number">-3.13</span>]<span class="meta"># make -j 4</span></div><div class="line">[root<span class="symbol">@localhost</span> inotify-tools<span class="number">-3.13</span>]<span class="meta"># make install</span></div><div class="line">[root<span class="symbol">@localhost</span> inotify-tools<span class="number">-3.13</span>]<span class="meta"># echo $?</span></div><div class="line"><span class="number">0</span></div></pre></td></tr></table></figure></p>
<p><code>测试</code><br><figure class="highlight golo"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root<span class="meta">@localhost</span> inotify-tools<span class="number">-3.13</span>]<span class="comment"># inotifywait -mrq -e create,move,delete,modify /var/www/html/</span></div><div class="line"><span class="comment"># 在另一个终端登，在/var/www/html目彔进行相关的操作，然后，回到原来的终端查看监控变化情况。</span></div><div class="line">[root<span class="meta">@localhost</span> ~]<span class="comment"># ssh root@192.168.134.137</span></div><div class="line">root@<span class="number">192.168</span><span class="number">.134</span><span class="number">.137</span>'s password: </div><div class="line">Last login: Wed Sep <span class="number">14</span> <span class="number">02</span>:<span class="number">41</span>:<span class="number">24</span> <span class="number">2016</span> from <span class="number">192.168</span><span class="number">.134</span><span class="number">.1</span></div><div class="line">[root<span class="meta">@localhost</span> ~]<span class="comment"># cd /var/www/html/</span></div><div class="line">[root<span class="meta">@localhost</span> html]<span class="comment"># ls</span></div><div class="line">grub</div><div class="line">[root<span class="meta">@localhost</span> html]<span class="comment"># cd grub/</span></div><div class="line">[root<span class="meta">@localhost</span> grub]<span class="comment"># ls</span></div><div class="line">device.<span class="keyword">map</span>     fat_stage1_5  grub.conf         jfs_stage1_5  minix_stage1_5     splash.xpm.gz  stage2         vstafs_stage1_5</div><div class="line">e2fs_stage1_5  ffs_stage1_5  iso9660_stage1_5  menu.lst      reiserfs_stage1_5  stage1         ufs2_stage1_5  xfs_stage1_5</div><div class="line">[root<span class="meta">@localhost</span> grub]<span class="comment"># rm -rf grub.conf</span></div><div class="line"><span class="comment"># 查看</span></div><div class="line">[root<span class="meta">@localhost</span> inotify-tools<span class="number">-3.13</span>]<span class="comment"># inotifywait -mrq -e create,move,delete,modify /var/www/html/  </span></div><div class="line">/<span class="keyword">var</span>/www/html/grub/ DELETE grub.conf</div></pre></td></tr></table></figure></p>
<p><code>同步时无交互</code><br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 创建Key</span></div><div class="line">[root@localhost inotify-tools-<span class="number">3.13</span>]<span class="comment"># ssh-keygen </span></div><div class="line">Generating public/private rsa key pair.</div><div class="line">Enter file <span class="keyword">in</span> which <span class="keyword">to</span> save the key (<span class="regexp">/root/</span>.ssh/id_rsa): </div><div class="line">Enter passphrase (empty <span class="keyword">for</span> <span class="literal">no</span> passphrase): </div><div class="line">Enter same passphrase again: </div><div class="line">Your identification has been saved <span class="keyword">in</span> <span class="regexp">/root/</span>.ssh/id_rsa.</div><div class="line">Your public key has been saved <span class="keyword">in</span> <span class="regexp">/root/</span>.ssh/id_rsa.pub.</div><div class="line">The key fingerprint is:</div><div class="line">d6:<span class="number">8d</span>:da:e0:<span class="number">25</span>:d9:<span class="number">87</span>:<span class="number">8c</span>:d7:<span class="number">52</span>:fb:<span class="number">4b</span>:<span class="number">6c</span>:<span class="number">92</span>:<span class="number">05</span>:af root@localhost.localdomain</div><div class="line">The key<span class="string">'s randomart image is:</span></div><div class="line">+--[ RSA 2048]----+</div><div class="line">|                 |</div><div class="line">|                 |</div><div class="line">|            o    |</div><div class="line">|         * * +   |</div><div class="line">|        S X = o  |</div><div class="line">|       o B o *   |</div><div class="line">|        o . E =  |</div><div class="line">|             + . |</div><div class="line">|              .  |</div><div class="line">+-----------------+</div><div class="line">[root@localhost inotify-tools-3.13]# ssh-copy-id root@192.168.134.143</div><div class="line">root@192.168.134.143's password: </div><div class="line">Now <span class="keyword">try</span> logging into the machine, <span class="keyword">with</span> <span class="string">"ssh 'root@192.168.134.143'"</span>, <span class="keyword">and</span> check in:</div><div class="line"></div><div class="line">  .ssh/authorized_keys</div><div class="line"></div><div class="line"><span class="keyword">to</span> make sure we haven<span class="string">'t added extra keys that you weren'</span>t expecting.</div><div class="line"></div><div class="line">[root@localhost inotify-tools-<span class="number">3.13</span>]<span class="comment"># ssh 192.168.134.143</span></div><div class="line">Last login: Wed Sep <span class="number">14</span> <span class="number">02</span>:<span class="number">33</span>:<span class="number">14</span> <span class="number">2016</span> <span class="keyword">from</span> <span class="number">192.168</span>.<span class="number">134.1</span></div><div class="line"></div><div class="line"><span class="comment"># 编写触发式同步脚本</span></div><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># cat &gt;&gt; auto.sh &lt;&lt; EOF</span></div><div class="line">&gt; <span class="comment">#!/bin/bash</span></div><div class="line">&gt; SRC=/<span class="keyword">var</span>/www/html</div><div class="line">&gt; DST=root@<span class="number">192.168</span>.<span class="number">134.143</span>:<span class="regexp">/backup/</span></div><div class="line">&gt; inotifywait -mrq -e create,move,<span class="keyword">delete</span>,modify $&#123;SRC&#125; | <span class="keyword">while</span> read a b c</div><div class="line">&gt; <span class="keyword">do</span></div><div class="line">&gt;         rsync -azP --<span class="keyword">delete</span> <span class="regexp">/var/www/html/</span> $DST</div><div class="line">&gt; done</div><div class="line">&gt; EOF</div><div class="line">[root@localhost ~]<span class="comment"># chmod +x auto.sh</span></div><div class="line"><span class="comment"># 后台运行</span></div><div class="line">[root@localhost ~]<span class="comment"># nohup auto.sh &amp;</span></div></pre></td></tr></table></figure></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Rsync/" rel="tag"># Rsync</a>
          
            <a href="/tags/数据同步/" rel="tag"># 数据同步</a>
          
            <a href="/tags/单独用户给目录添加特殊权限/" rel="tag"># 单独用户给目录添加特殊权限</a>
          
            <a href="/tags/无交互备份/" rel="tag"># 无交互备份</a>
          
            <a href="/tags/SSH密钥/" rel="tag"># SSH密钥</a>
          
            <a href="/tags/增量备份/" rel="tag"># 增量备份</a>
          
            <a href="/tags/文件打包/" rel="tag"># 文件打包</a>
          
            <a href="/tags/后台运行/" rel="tag"># 后台运行</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/04/11/Zabbix-3-x-Install/" rel="next" title="Zabbix 3.x Install">
                <i class="fa fa-chevron-left"></i> Zabbix 3.x Install
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/04/11/LVM-Disk-Extension/" rel="prev" title="LVM Disk Extension">
                LVM Disk Extension <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="从心来过" />
          <p class="site-author-name" itemprop="name">从心来过</p>
           
              <p class="site-description motion-element" itemprop="description">都付笑谈中</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://www.baidu.com" target="_blank" title="baidu">
                  
                    <i class="fa fa-fw fa-desktop"></i>
                  
                  baidu
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装程序"><span class="nav-number">1.</span> <span class="nav-text">安装程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#激活rsync"><span class="nav-number">2.</span> <span class="nav-text">激活rsync</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动服务"><span class="nav-number">3.</span> <span class="nav-text">启动服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看服务"><span class="nav-number">4.</span> <span class="nav-text">查看服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建上传和下载用户"><span class="nav-number">5.</span> <span class="nav-text">创建上传和下载用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单独用户给目录添加权限"><span class="nav-number">6.</span> <span class="nav-text">单独用户给目录添加权限</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#源服务器创建测试数据"><span class="nav-number">7.</span> <span class="nav-text">源服务器创建测试数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#备份服务器创建备份目录"><span class="nav-number">8.</span> <span class="nav-text">备份服务器创建备份目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用命令执行备份"><span class="nav-number">9.</span> <span class="nav-text">用命令执行备份</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSH密钥无交互备份"><span class="nav-number">10.</span> <span class="nav-text">SSH密钥无交互备份</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#拷贝密钥到源服务器"><span class="nav-number">11.</span> <span class="nav-text">拷贝密钥到源服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试无交互登录"><span class="nav-number">12.</span> <span class="nav-text">测试无交互登录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试同步"><span class="nav-number">13.</span> <span class="nav-text">测试同步</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编写脚本测试且查看结果"><span class="nav-number">14.</span> <span class="nav-text">编写脚本测试且查看结果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#定期增量备份"><span class="nav-number">15.</span> <span class="nav-text">定期增量备份</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#备份之后打包"><span class="nav-number">16.</span> <span class="nav-text">备份之后打包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用非系统用户进行备份"><span class="nav-number">17.</span> <span class="nav-text">使用非系统用户进行备份</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rsync-amp-inotify实时同步"><span class="nav-number">18.</span> <span class="nav-text">rsync&inotify实时同步</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">从心来过</span>
</div>





        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  







  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  

  

  

</body>
</html>
